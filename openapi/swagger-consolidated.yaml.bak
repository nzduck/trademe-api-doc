openapi: 3.1.0
info:
  title: Trade Me API (community)
  version: 0.1.0
  description: >
    Community-maintained OpenAPI spec derived from public HTML docs.
    This consolidated file includes all referenced components inline for Swagger UI compatibility.

servers:
  - url: https://api.tmsandbox.co.nz/v1
    description: Sandbox
  - url: https://api.trademe.co.nz/v1
    description: Production

security:
  - TradeMeOAuth: []

components:
  securitySchemes:
    TradeMeOAuth:
      type: oauth1
      description: |
        Trade Me uses OAuth 1.0a for authentication. Most endpoints require authentication.
        
        To get started:
        1. Register your application at https://developer.trademe.co.nz/
        2. Obtain consumer key and secret
        3. Follow OAuth 1.0a flow to get access token
        
        For more details see: https://developer.trademe.co.nz/api-overview/authentication
      flows:
        authorizationUrl: https://secure.trademe.co.nz/Oauth/Authorize
        tokenUrl: https://secure.trademe.co.nz/Oauth/RequestToken

  parameters:
    listingId:
      name: listingId
      in: path
      required: true
      description: The ID of the listing to retrieve.
      schema:
        type: integer
        minimum: 1
      example: 2149713189

    fileFormat:
      name: file_format
      in: path
      required: true
      description: The format of the response.
      schema:
        type: string
        enum: ["xml", "json"]
        default: "json"
      example: "json"

    categoryNumber:
      name: number
      in: path
      required: true
      description: The category number of the root of the returned tree. If this parameter is empty, it returns a fictional category named "Root" with all the top categories included as subcategories.
      schema:
        type: string
      example: "0004-0369-"

  responses:
    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            type: object
            properties:
              ErrorDescription:
                type: string
                example: "The listing was not found"
              Request:
                type: string
                example: "/listings/2149713189.json"

  schemas:
    Category:
      type: object
      description: Trade Me category information
      additionalProperties: true
      properties:
        Name:
          type: string
          nullable: true
          description: The name of the category
          example: "Antiques & collectables"
        Number:
          type: string
          nullable: true
          description: A unique identifier for the category
          example: "0004-0369-6076-"
        Path:
          type: string
          nullable: true
          description: The full URL path of this category
          example: "/Antiques-collectables/Collectables/Badges-pins"
        Subcategories:
          type: array
          nullable: true
          description: The list of subcategories belonging to this category
          items:
            $ref: "#/components/schemas/Category"
        Count:
          type: integer
          description: The number of items for sale in this category
          example: 1234
        IsRestricted:
          type: boolean
          description: Indicates whether the category is restricted to adults only (i.e. the category is R18)
          example: false
        HasLegalNotice:
          type: boolean
          description: Indicates whether the category has legal requirements
          example: false
        HasClassifieds:
          type: boolean
          description: Indicates whether classifieds are allowed in this category
          example: false
        AreaOfBusiness:
          type: integer
          description: Area of business this category is related to
          enum: [0, 1, 2, 3, 4, 5]
          example: 1
        CanHaveSecondCategory:
          type: boolean
          description: Indicates whether this category can be paired with a second category
          example: false
        CanBeSecondCategory:
          type: boolean
          description: Indicates whether this category can be selected as a second category
          example: false
        IsLeaf:
          type: boolean
          description: Indicates whether the category is a leaf category (i.e. has no children)
          example: true

    # Simplified Listing schema with key enum fields
    Listing:
      type: object
      description: Trade Me listing details with complete enum descriptions
      additionalProperties: true
      properties:
        ListingId:
          type: integer
          description: The ID of the listing.
        Title:
          type: string
          nullable: true
          description: The listing title.
        BackgroundRecheckEligibility:
          type: string
          nullable: true
          description: What background check elements will be rechecked (if any) upon acceptance. Applies to motors listings.
          enum: ["1", "99"]
          x-enum-descriptions:
            - "This offer is subject to recheck of money owing and stolen status upon acceptance"
            - "This offer is not subject to recheck any background check items"
        ReserveState:
          type: string
          description: The flag to display on an item.
          enum: ["0", "1", "2", "3"]
          x-enum-descriptions:
            - "There is no reserve on the item (i.e. the reserve price is the same as the starting price)."
            - "The value of the highest bid has exceeded the reserve price."
            - "The value of the highest bid has not reached the reserve price."
            - "The listing cannot have a reserve because bidding is not allowed. This may be because it is a classified or because it is a Buy Now Only auction."
        AllowsPickups:
          type: string
          description: The pickup option for the listing.
          enum: ["0", "1", "2", "3"]
          x-enum-descriptions:
            - "The listing allows pick up, but does not require it."
            - "The buyer can pickup if they so choose."
            - "The buyer must pickup the item."
            - "The buyer cannot pickup the item (delivery only)."
        WatchlistReminder:
          type: string
          description: If the item is on the watchlist, it indicates the user's preference of when they should get watchlist emails for the item.
          enum: ["0", "1", "2", "4"]
          x-enum-descriptions:
            - "No emails for watchlist items."
            - "One hour before the listing closes."
            - "Twelve hours before the listing closes."
            - "Twenty hours before the listing closes."
        OfferStatus:
          type: string
          description: The status of the fixed price offer for this listing (if there is one). Only available if you are the seller or a recipient of the offer.
          enum: ["0", "1", "2", "3", "4", "5"]
          x-enum-descriptions:
            - "A fixed price offer has not been created for this listing, or you are not the seller or a recipient and so no information is available."
            - "A fixed price offer is currently active. The PendingOffer field will contain details of the offer."
            - "A fixed price offer was created, but then was withdrawn by the seller."
            - "A fixed price offer was created, but time ran out before all the recipients could respond."
            - "The fixed price offer was declined by all the recipients."
            - "The fixed price offer was accepted."
        PriceType:
          type: string
          nullable: true
          description: Indicates the price type of boat and farming machinery listings
          enum: ["0", "1", "2"]
          x-enum-descriptions:
            - "Asking Price."
            - "Price On Application."
            - "Excluding GST."
        ListingPlatform:
          type: string
          description: The backend platform that controls the listing.
          enum: ["0", "1", "2"]
          x-enum-descriptions:
            - "The platform has not been set."
            - "The listing is controlled by Trade Me."
            - "The listing is controlled by Koru."
        StartPrice:
          type: number
          description: The start price.
        BuyNowPrice:
          type: number
          description: The Buy Now price.
        PriceDisplay:
          type: string
          nullable: true
          description: The price, in a format suitable for displaying to the user.
        CategoryPath:
          type: string
          nullable: true
          description: The category path.

    SearchResult:
      type: object
      description: Search results from Trade Me
      properties:
        TotalCount:
          type: integer
          description: Total number of results found
        Page:
          type: integer
          description: Current page number
        PageSize:
          type: integer
          description: Number of results per page
        List:
          type: array
          description: Array of listings
          items:
            $ref: "#/components/schemas/Listing"

    SearchSuggestions:
      type: object
      description: Search suggestions based on search terms, including category suggestions, recent searches, and auto-suggestions
      properties:
        RecentSearches:
          type: array
          nullable: true
          description: List of search terms the logged in member has recently searched for ordered by most recent first
          items:
            type: string
        AutoSuggestions:
          type: array
          nullable: true
          description: List of suggested search terms based on terms popular with Trade Me members ordered by their popularity
          items:
            type: object
            properties:
              SearchTerm:
                type: string
                nullable: true
                description: The search term Trade Me members have been using
              SearchTermCategorySuggestions:
                type: array
                nullable: true
                description: Categories we suggest you search for the search term in
                items:
                  type: object
                  properties:
                    Id:
                      type: integer
                      description: The ID of the category
                    Description:
                      type: string
                      nullable: true
                      description: The description for the suggested category
        CategorySuggestions:
          type: array
          nullable: true
          description: List of category suggestions that are relevant to the given search term
          items:
            type: object
            properties:
              Id:
                type: integer
                description: The ID of the suggested category
              Name:
                type: string
                nullable: true
                description: The name of the suggested category
              AncestorsNames:
                type: array
                nullable: true
                description: A list of names of the suggested categories ancestors, ordered from root to leaf
                items:
                  type: string
        StoreSuggestions:
          type: array
          nullable: true
          description: List of store suggestions that are relevant to the given search term
          items:
            type: object
            properties:
              MemberId:
                type: integer
                description: The ID of the suggested store
              StoreName:
                type: string
                nullable: true
                description: The name of the suggested store
              StorePath:
                type: string
                nullable: true
                description: The path of the suggested store
              Description:
                type: string
                nullable: true
                description: The description of the suggested store
              LogoImageUri:
                type: string
                nullable: true
                description: The profile logo image URL of the suggested store

paths:
  /listings/{listingId}.{file_format}:
    get:
      tags: [Listings]
      summary: Retrieve the details of a single listing
      description: Retrieves comprehensive details for a specific marketplace listing using its unique identifier.
      operationId: getListingById
      externalDocs:
        description: Official Trade Me API Documentation
        url: https://developer.trademe.co.nz/api-reference/listing-methods/retrieve-the-details-of-a-single-listing
      parameters:
        - $ref: "#/components/parameters/listingId"
        - $ref: "#/components/parameters/fileFormat"
        - name: increment_view_count
          in: query
          required: false
          description: Indicates whether to increment the view count on the listing. Defaults to true.
          schema:
            type: boolean
            default: true
        - name: question_limit
          in: query
          required: false
          description: The maximum number of questions and answers to return. Defaults to unlimited.
          schema:
            type: integer
            minimum: 0
        - name: return_member_profile
          in: query
          required: false
          description: If true also returns the member's public profile information. Defaults to false.
          schema:
            type: boolean
            default: false
      responses:
        "200":
          description: Listing found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Listing"
              examples:
                minimal:
                  summary: Minimal example with enum values
                  value:
                    ListingId: 2149713189
                    Title: "Vintage lamp"
                    PriceDisplay: "$49.00"
                    BackgroundRecheckEligibility: "1"
                    ReserveState: "0"
                    AllowsPickups: "1"
                    WatchlistReminder: "2"
                    OfferStatus: "0"
                    PriceType: "0"
                    ListingPlatform: "1"
        "404":
          $ref: "#/components/responses/NotFound"

  /categories/{number}.{file_format}:
    get:
      tags: [Catalogue]
      summary: Retrieve general categories
      description: Retrieves all or part of the Trade Me category tree.
      operationId: getCategories
      security: []  # This endpoint does not require authentication
      externalDocs:
        description: Official Trade Me API Documentation
        url: https://developer.trademe.co.nz/api-reference/catalogue-methods/retrieve-general-categories
      parameters:
        - $ref: "#/components/parameters/categoryNumber"
        - $ref: "#/components/parameters/fileFormat"
        - name: depth
          in: query
          required: false
          description: The depth of the category tree to return. 0 = a single category. 1 = the specified category plus any subcategories. The default is to return all subcategories.
          schema:
            type: integer
            minimum: 0
          example: 1
        - name: with_counts
          in: query
          required: false
          description: Indicates whether to include the number of listings in each category. Defaults to false.
          schema:
            type: boolean
            default: false
          example: true
      responses:
        "200":
          description: Category tree successfully retrieved
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Category"
        "404":
          $ref: "#/components/responses/NotFound"

  /Search/General.{file_format}:
    get:
      tags: [Search]
      summary: General search
      description: Allows you to search for listings on Trade Me by category, by keywords or a combination of these two. The result set can be filtered by a variety of properties, including availability of Buy Now, Pay Now, item condition or seller.
      operationId: searchGeneral
      externalDocs:
        description: Official Trade Me API Documentation
        url: https://developer.trademe.co.nz/api-reference/search-methods/general-search
      parameters:
        - $ref: "#/components/parameters/fileFormat"
        - name: search_string
          in: query
          required: false
          description: One or more keywords to use in a search query.
          schema:
            type: string
          example: "iPhone"
        - name: category
          in: query
          required: false
          description: Specifies the category in which you want to perform the search (e.g. 3419 or "0124-3419-" for Electronics & photography > Camera accessories).
          schema:
            type: string
          example: "0124-3419-"
        - name: page
          in: query
          required: false
          description: The page number of the set of results to return, starting from 1. Defaults to 1.
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: rows
          in: query
          required: false
          description: The number of results per page. The maximum is 25 for unauthenticated requests and 500 for authenticated requests. Defaults to 25 (unauthenticated) or 50 (authenticated).
          schema:
            type: integer
            minimum: 1
            maximum: 500
        - name: buy
          in: query
          required: false
          description: Filters listings to only those with Buy Now.
          schema:
            type: string
        - name: condition
          in: query
          required: false
          description: Filter listings by condition.
          schema:
            type: string
        - name: listed_as
          in: query
          required: false
          description: Restricts search to either auctions or classifieds
          schema:
            type: string
        - name: payment_types
          in: query
          required: false
          description: A comma-separated list of payment types. Valid values are "PayNow", "Afterpay".
          schema:
            type: string
          example: "PayNow,Afterpay"
        - name: photo_size
          in: query
          required: false
          description: The size of the images to return in the results. Defaults to Thumbnail.
          schema:
            type: string
            enum: [Thumbnail, List, Medium, Gallery, Large, FullSize, PlusSize]
            default: Thumbnail
        - name: sort_order
          in: query
          required: false
          description: Sorts the returned results using the specified sort order.
          schema:
            type: string
            enum: [Default, TitleAsc, TitleDesc, PriceAsc, PriceDesc, ReserveAsc, ReserveDesc, 
                   BidCountAsc, BidCountDesc, ExpiryAsc, ExpiryDesc, FeaturedFirst, 
                   ListingLengthAsc, ListingLengthDesc]
            default: Default
        - name: user_region
          in: query
          required: false
          description: Restricts search results to items from sellers located in the region with the given ID.
          schema:
            type: integer
        - name: shipping_method
          in: query
          required: false
          description: Filters listings to those that have free shipping or those that allow pick ups.
          schema:
            type: string
      responses:
        "200":
          description: Search completed successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SearchResult"
              examples:
                search_results:
                  summary: Search results with enum examples
                  value:
                    TotalCount: 156
                    Page: 1
                    PageSize: 20
                    List:
                      - ListingId: 2149713189
                        Title: "iPhone 12 Pro Max 128GB"
                        PriceDisplay: "$899.00"
                        BackgroundRecheckEligibility: "1"
                        ReserveState: "1" 
                        AllowsPickups: "2"
                        CategoryPath: "/Mobile-phones/Apple"
        "400":
          description: Bad request - invalid search parameters
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "BadRequest"
                  message:
                    type: string
                    example: "Invalid search parameters"

  /Search/Suggestions.{file_format}:
    get:
      tags: [Search]
      summary: Get search suggestions
      description: |
        Returns up to three collections of search suggestions all based on the passed in search term:
        - Autosuggestions - suggestions based on similar search terms popular with the Trade Me community
        - Recent searches - suggestions based on previous searches the logged in member has performed  
        - Category suggestions - suggestions based on categories similar to the passed in search term
      operationId: getSearchSuggestions
      externalDocs:
        description: Official Trade Me API Documentation
        url: https://developer.trademe.co.nz/api-reference/search-methods/get-search-suggestions
      parameters:
        - $ref: "#/components/parameters/fileFormat"
        - name: search_string
          in: query
          required: false
          description: The partial keyword that the suggestions will be based on.
          schema:
            type: string
          example: "iphone"
        - name: category_id
          in: query
          required: false
          description: The identifier of the category to be used when generating suggestions, use 0 for all categories. Defaults to 0.
          schema:
            type: integer
            default: 0
          example: 0
        - name: max_auto_suggestions
          in: query
          required: false
          description: The maximum number of autosuggest suggestions to be returned. Defaults to 12.
          schema:
            type: integer
            default: 12
            minimum: 1
        - name: max_category_suggestions
          in: query
          required: false
          description: The maximum number of category suggestions to be returned. Defaults to 12.
          schema:
            type: integer
            default: 12
            minimum: 1
        - name: max_recent_searches
          in: query
          required: false
          description: The maximum number of recent searches to be returned. Defaults to 12.
          schema:
            type: integer
            default: 12
            minimum: 1
        - name: max_total_suggestions
          in: query
          required: false
          description: The maximum number of suggestions of all types to be returned. Defaults to 12.
          schema:
            type: integer
            default: 12
            minimum: 1
      responses:
        "200":
          description: Search suggestions retrieved successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SearchSuggestions"
              examples:
                suggestions:
                  summary: Search suggestions example
                  value:
                    RecentSearches: ["laptop", "macbook"]
                    AutoSuggestions:
                      - SearchTerm: "iphone 12"
                        SearchTermCategorySuggestions:
                          - Id: 3419
                            Description: "Mobile phones"
                      - SearchTerm: "iphone case"
                        SearchTermCategorySuggestions:
                          - Id: 3420
                            Description: "Mobile accessories"
                    CategorySuggestions:
                      - Id: 3419
                        Name: "Mobile phones"
                        AncestorsNames: ["Electronics & photography", "Mobile phones"]
                      - Id: 3420
                        Name: "Mobile accessories" 
                        AncestorsNames: ["Electronics & photography", "Mobile accessories"]
                    StoreSuggestions:
                      - MemberId: 12345
                        StoreName: "Tech Store NZ"
                        StorePath: "/stores/tech-store-nz"
                        Description: "Premium electronics retailer"
                        LogoImageUri: "https://images.trademe.co.nz/stores/12345/logo.jpg"
        "400":
          description: Bad request - invalid parameters
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "BadRequest"
                  message:
                    type: string
                    example: "Invalid search parameters"